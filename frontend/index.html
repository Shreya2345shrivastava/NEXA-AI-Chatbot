<!DOCTYPE html>
<html>
<head>
  <title>NEXA AI Chatbot</title>
</head>
<body>

  <h2>AI Chatbot</h2>

  <input id="msg" placeholder="Type or speak..." />
  <button onclick="send()">Send</button>
  <button onclick="startVoice()">üé§ Speak</button>

  <br><br>

  <button onclick="pauseSpeech()">‚è∏ Pause</button>
  <button onclick="resumeSpeech()">‚ñ∂ Resume</button>
  <button onclick="stopSpeech()">‚èπ Stop</button>

  <p id="reply"></p>

  <script>
    // Stop any speech on page load / reload
    window.onload = () => {
      window.speechSynthesis.cancel();
    };

    async function send(textFromVoice = null) {
      const message =
        textFromVoice || document.getElementById("msg").value;

      if (!message) return;

      stopSpeech(); // stop previous speech

      const res = await fetch("http://localhost:5000/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });

      const data = await res.json();
      document.getElementById("reply").innerText = data.reply;

      speak(data.reply);
    }

    function startVoice() {
      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;

      if (!SpeechRecognition) {
        alert("Speech Recognition not supported in this browser.");
        return;
      }

      const recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.start();

      recognition.onresult = function (event) {
        const spokenText = event.results[0][0].transcript;
        document.getElementById("msg").value = spokenText;
        send(spokenText);
      };
    }

    let utterance;

    function speak(text) {
      utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-US";
      window.speechSynthesis.speak(utterance);
    }

    function pauseSpeech() {
      if (window.speechSynthesis.speaking) {
        window.speechSynthesis.pause();
      }
    }

    function resumeSpeech() {
      if (window.speechSynthesis.paused) {
        window.speechSynthesis.resume();
      }
    }

    function stopSpeech() {
      window.speechSynthesis.cancel();
    }
  </script>

</body>
</html>
